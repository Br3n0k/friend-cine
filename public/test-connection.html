<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de ConexÃ£o - Friend Cine</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #1a1a2e;
            color: white;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success { background: #27ae60; }
        .error { background: #e74c3c; }
        .warning { background: #f39c12; }
        .info { background: #3498db; }
        pre {
            background: #2c3e50;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª Teste de Conectividade - Friend Cine</h1>
    
    <div id="results"></div>
    
    <h2>ğŸ“ Log de Testes</h2>
    <pre id="log"></pre>

    <!-- Socket.io -->
    <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
    
    <script>
        const results = document.getElementById('results');
        const logElement = document.getElementById('log');
        
        function addResult(type, message) {
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = message;
            results.appendChild(div);
        }
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            logElement.textContent += `[${timestamp}] ${message}\n`;
            console.log(message);
        }
        
        log('ğŸ¬ Iniciando testes do Friend Cine...');
        
        // Teste 1: Socket.io
        if (typeof io !== 'undefined') {
            addResult('success', 'âœ… Socket.io carregado com sucesso');
            log('âœ… Socket.io estÃ¡ disponÃ­vel');
            
            // Teste 2: ConexÃ£o com servidor
            log('ğŸ”Œ Tentando conectar com o servidor...');
            const socket = io('http://localhost:4000');
            
            socket.on('connect', () => {
                addResult('success', 'âœ… Conectado ao servidor backend');
                log('âœ… ConexÃ£o estabelecida com o servidor');
                
                // Teste 3: Criar sala de teste
                socket.emit('join-room', { 
                    roomId: 'teste-conexao', 
                    username: 'Usuario-Teste' 
                });
            });
            
            socket.on('room-state', (roomState) => {
                addResult('success', 'âœ… Recebendo dados da sala');
                log('âœ… Dados da sala recebidos: ' + JSON.stringify(roomState));
            });
            
            socket.on('connect_error', (error) => {
                addResult('error', 'âŒ Erro na conexÃ£o: ' + error.message);
                log('âŒ Erro de conexÃ£o: ' + error.message);
            });
            
            socket.on('disconnect', (reason) => {
                addResult('warning', 'âš ï¸ Desconectado: ' + reason);
                log('âš ï¸ Desconectado: ' + reason);
            });
            
            // Timeout se nÃ£o conectar
            setTimeout(() => {
                if (!socket.connected) {
                    addResult('error', 'âŒ Timeout: NÃ£o foi possÃ­vel conectar em 10 segundos');
                    log('âŒ Timeout de conexÃ£o');
                }
            }, 10000);
            
        } else {
            addResult('error', 'âŒ Socket.io nÃ£o foi carregado');
            log('âŒ Socket.io nÃ£o estÃ¡ disponÃ­vel');
        }
        
        // Teste 4: API do backend
        log('ğŸŒ Testando API do backend...');
        fetch('http://localhost:4000/api/health')
            .then(response => {
                if (response.ok) {
                    addResult('success', 'âœ… API do backend respondendo');
                    log('âœ… API health check OK');
                    return response.json();
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            })
            .then(data => {
                log('âœ… Resposta da API: ' + JSON.stringify(data));
            })
            .catch(error => {
                addResult('error', 'âŒ API nÃ£o responde: ' + error.message);
                log('âŒ Erro na API: ' + error.message);
            });
            
        // Teste 5: VÃ­deos
        fetch('http://localhost:4000/api/videos')
            .then(response => response.json())
            .then(videos => {
                addResult('info', `ğŸ“¹ ${videos.length} vÃ­deo(s) encontrado(s)`);
                log(`ğŸ“¹ VÃ­deos disponÃ­veis: ${videos.length}`);
            })
            .catch(error => {
                addResult('error', 'âŒ Erro ao buscar vÃ­deos: ' + error.message);
                log('âŒ Erro nos vÃ­deos: ' + error.message);
            });
    </script>
</body>
</html> 