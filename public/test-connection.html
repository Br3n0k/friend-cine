<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Conexão - Friend Cine</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #1a1a2e;
            color: white;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success { background: #27ae60; }
        .error { background: #e74c3c; }
        .warning { background: #f39c12; }
        .info { background: #3498db; }
        pre {
            background: #2c3e50;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>🧪 Teste de Conectividade - Friend Cine</h1>
    
    <div id="results"></div>
    
    <h2>📝 Log de Testes</h2>
    <pre id="log"></pre>

    <!-- Socket.io -->
    <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
    
    <script>
        const results = document.getElementById('results');
        const logElement = document.getElementById('log');
        
        function addResult(type, message) {
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = message;
            results.appendChild(div);
        }
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            logElement.textContent += `[${timestamp}] ${message}\n`;
            console.log(message);
        }
        
        log('🎬 Iniciando testes do Friend Cine...');
        
        // Teste 1: Socket.io
        if (typeof io !== 'undefined') {
            addResult('success', '✅ Socket.io carregado com sucesso');
            log('✅ Socket.io está disponível');
            
            // Teste 2: Conexão com servidor
            log('🔌 Tentando conectar com o servidor...');
            const socket = io('http://localhost:4000');
            
            socket.on('connect', () => {
                addResult('success', '✅ Conectado ao servidor backend');
                log('✅ Conexão estabelecida com o servidor');
                
                // Teste 3: Criar sala de teste
                socket.emit('join-room', { 
                    roomId: 'teste-conexao', 
                    username: 'Usuario-Teste' 
                });
            });
            
            socket.on('room-state', (roomState) => {
                addResult('success', '✅ Recebendo dados da sala');
                log('✅ Dados da sala recebidos: ' + JSON.stringify(roomState));
            });
            
            socket.on('connect_error', (error) => {
                addResult('error', '❌ Erro na conexão: ' + error.message);
                log('❌ Erro de conexão: ' + error.message);
            });
            
            socket.on('disconnect', (reason) => {
                addResult('warning', '⚠️ Desconectado: ' + reason);
                log('⚠️ Desconectado: ' + reason);
            });
            
            // Timeout se não conectar
            setTimeout(() => {
                if (!socket.connected) {
                    addResult('error', '❌ Timeout: Não foi possível conectar em 10 segundos');
                    log('❌ Timeout de conexão');
                }
            }, 10000);
            
        } else {
            addResult('error', '❌ Socket.io não foi carregado');
            log('❌ Socket.io não está disponível');
        }
        
        // Teste 4: API do backend
        log('🌐 Testando API do backend...');
        fetch('http://localhost:4000/api/health')
            .then(response => {
                if (response.ok) {
                    addResult('success', '✅ API do backend respondendo');
                    log('✅ API health check OK');
                    return response.json();
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            })
            .then(data => {
                log('✅ Resposta da API: ' + JSON.stringify(data));
            })
            .catch(error => {
                addResult('error', '❌ API não responde: ' + error.message);
                log('❌ Erro na API: ' + error.message);
            });
            
        // Teste 5: Vídeos
        fetch('http://localhost:4000/api/videos')
            .then(response => response.json())
            .then(videos => {
                addResult('info', `📹 ${videos.length} vídeo(s) encontrado(s)`);
                log(`📹 Vídeos disponíveis: ${videos.length}`);
            })
            .catch(error => {
                addResult('error', '❌ Erro ao buscar vídeos: ' + error.message);
                log('❌ Erro nos vídeos: ' + error.message);
            });
    </script>
</body>
</html> 